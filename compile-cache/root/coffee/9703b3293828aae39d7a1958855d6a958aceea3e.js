(function() {
  module.exports = function(colorPicker) {
    return {
      Emitter: (require('../modules/Emitter'))(),
      element: null,
      control: null,
      canvas: null,
      getHue: function() {
        if ((this.control && this.control.selection) && this.element) {
          return this.control.selection.y / this.element.getHeight() * 360;
        } else {
          return 0;
        }
      },
      emitSelectionChanged: function() {
        return this.Emitter.emit('selectionChanged', this.control.selection);
      },
      onSelectionChanged: function(callback) {
        return this.Emitter.on('selectionChanged', callback);
      },
      emitColorChanged: function() {
        return this.Emitter.emit('colorChanged', this.control.selection.color);
      },
      onColorChanged: function(callback) {
        return this.Emitter.on('colorChanged', callback);
      },
      activate: function() {
        var Body;
        Body = colorPicker.getExtension('Body');
        this.element = {
          el: (function() {
            var _classPrefix, _el;
            _classPrefix = Body.element.el.className;
            _el = document.createElement('div');
            _el.classList.add(_classPrefix + "-hue");
            return _el;
          })(),
          width: 0,
          height: 0,
          getWidth: function() {
            return this.width || this.el.offsetWidth;
          },
          getHeight: function() {
            return this.height || this.el.offsetHeight;
          },
          rect: null,
          getRect: function() {
            return this.rect || this.updateRect();
          },
          updateRect: function() {
            return this.rect = this.el.getClientRects()[0];
          },
          add: function(element) {
            this.el.appendChild(element);
            return this;
          }
        };
        Body.element.add(this.element.el, 2);
        colorPicker.onOpen((function(_this) {
          return function() {
            var _rect;
            if (!(_this.element.updateRect() && (_rect = _this.element.getRect()))) {
              return;
            }
            _this.width = _rect.width;
            return _this.height = _rect.height;
          };
        })(this));
        setTimeout((function(_this) {
          return function() {
            var Hue, _context, _elementHeight, _elementWidth, _gradient, _hex, _hexes, _i, _step, i, len;
            Hue = _this;
            _elementWidth = _this.element.getWidth();
            _elementHeight = _this.element.getHeight();
            _hexes = ['#f00', '#ff0', '#0f0', '#0ff', '#00f', '#f0f', '#f00'];
            _this.canvas = {
              el: (function() {
                var _el;
                _el = document.createElement('canvas');
                _el.width = _elementWidth;
                _el.height = _elementHeight;
                _el.classList.add(Hue.element.el.className + "-canvas");
                return _el;
              })(),
              context: null,
              getContext: function() {
                return this.context || (this.context = this.el.getContext('2d'));
              },
              getColorAtPosition: function(y) {
                return colorPicker.SmartColor.HSVArray([y / Hue.element.getHeight() * 360, 100, 100]);
              }
            };
            _context = _this.canvas.getContext();
            _step = 1 / (_hexes.length - 1);
            _gradient = _context.createLinearGradient(0, 0, 1, _elementHeight);
            for (_i = i = 0, len = _hexes.length; i < len; _i = ++i) {
              _hex = _hexes[_i];
              _gradient.addColorStop(_step * _i, _hex);
            }
            _context.fillStyle = _gradient;
            _context.fillRect(0, 0, _elementWidth, _elementHeight);
            return _this.element.add(_this.canvas.el);
          };
        })(this));
        setTimeout((function(_this) {
          return function() {
            var Hue, hasChild;
            hasChild = function(element, child) {
              var _parent;
              if (child && (_parent = child.parentNode)) {
                if (child === element) {
                  return true;
                } else {
                  return hasChild(element, _parent);
                }
              }
              return false;
            };
            Hue = _this;
            _this.control = {
              el: (function() {
                var _el;
                _el = document.createElement('div');
                _el.classList.add(Hue.element.el.className + "-control");
                return _el;
              })(),
              isGrabbing: false,
              selection: {
                y: 0,
                color: null
              },
              setSelection: function(e, y, offset) {
                var _height, _position, _rect, _width, _y;
                if (y == null) {
                  y = null;
                }
                if (offset == null) {
                  offset = null;
                }
                if (!(Hue.canvas && (_rect = Hue.element.getRect()))) {
                  return;
                }
                _width = Hue.element.getWidth();
                _height = Hue.element.getHeight();
                if (e) {
                  _y = e.pageY - _rect.top;
                } else if (typeof y === 'number') {
                  _y = y;
                } else if (typeof offset === 'number') {
                  _y = this.selection.y + offset;
                } else {
                  _y = this.selection.y;
                }
                _y = this.selection.y = Math.max(0, Math.min(_height, _y));
                this.selection.color = Hue.canvas.getColorAtPosition(_y);
                _position = {
                  y: Math.max(3, Math.min(_height - 6, _y))
                };
                requestAnimationFrame((function(_this) {
                  return function() {
                    return _this.el.style.top = _position.y + "px";
                  };
                })(this));
                return Hue.emitSelectionChanged();
              },
              refreshSelection: function() {
                return this.setSelection();
              }
            };
            _this.control.refreshSelection();
            colorPicker.onInputColor(function(smartColor) {
              var _hue;
              _hue = smartColor.toHSVArray()[0];
              return _this.control.setSelection(null, (_this.element.getHeight() / 360) * _hue);
            });
            Hue.onSelectionChanged(function() {
              return Hue.emitColorChanged();
            });
            colorPicker.onOpen(function() {
              return _this.control.refreshSelection();
            });
            colorPicker.onOpen(function() {
              return _this.control.isGrabbing = false;
            });
            colorPicker.onClose(function() {
              return _this.control.isGrabbing = false;
            });
            colorPicker.onMouseDown(function(e, isOnPicker) {
              if (!(isOnPicker && hasChild(Hue.element.el, e.target))) {
                return;
              }
              e.preventDefault();
              _this.control.isGrabbing = true;
              return _this.control.setSelection(e);
            });
            colorPicker.onMouseMove(function(e) {
              if (!_this.control.isGrabbing) {
                return;
              }
              return _this.control.setSelection(e);
            });
            colorPicker.onMouseUp(function(e) {
              if (!_this.control.isGrabbing) {
                return;
              }
              _this.control.isGrabbing = false;
              return _this.control.setSelection(e);
            });
            colorPicker.onMouseWheel(function(e, isOnPicker) {
              if (!(isOnPicker && hasChild(Hue.element.el, e.target))) {
                return;
              }
              e.preventDefault();
              return _this.control.setSelection(null, null, e.wheelDeltaY * .33);
            });
            return _this.element.add(_this.control.el);
          };
        })(this));
        return this;
      }
    };
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiL2hvbWUvc3lhaWYvLmF0b20vcGFja2FnZXMvY29sb3ItcGlja2VyL2xpYi9leHRlbnNpb25zL0h1ZS5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBS0k7RUFBQSxNQUFNLENBQUMsT0FBUCxHQUFpQixTQUFDLFdBQUQ7V0FDYjtNQUFBLE9BQUEsRUFBUyxDQUFDLE9BQUEsQ0FBUSxvQkFBUixDQUFELENBQUEsQ0FBQSxDQUFUO01BRUEsT0FBQSxFQUFTLElBRlQ7TUFHQSxPQUFBLEVBQVMsSUFIVDtNQUlBLE1BQUEsRUFBUSxJQUpSO01BU0EsTUFBQSxFQUFRLFNBQUE7UUFDSixJQUFHLENBQUMsSUFBQyxDQUFBLE9BQUQsSUFBYSxJQUFDLENBQUEsT0FBTyxDQUFDLFNBQXZCLENBQUEsSUFBc0MsSUFBQyxDQUFBLE9BQTFDO0FBQ0ksaUJBQU8sSUFBQyxDQUFBLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBbkIsR0FBdUIsSUFBQyxDQUFBLE9BQU8sQ0FBQyxTQUFULENBQUEsQ0FBdkIsR0FBOEMsSUFEekQ7U0FBQSxNQUFBO0FBRUssaUJBQU8sRUFGWjs7TUFESSxDQVRSO01Ba0JBLG9CQUFBLEVBQXNCLFNBQUE7ZUFDbEIsSUFBQyxDQUFBLE9BQU8sQ0FBQyxJQUFULENBQWMsa0JBQWQsRUFBa0MsSUFBQyxDQUFBLE9BQU8sQ0FBQyxTQUEzQztNQURrQixDQWxCdEI7TUFvQkEsa0JBQUEsRUFBb0IsU0FBQyxRQUFEO2VBQ2hCLElBQUMsQ0FBQSxPQUFPLENBQUMsRUFBVCxDQUFZLGtCQUFaLEVBQWdDLFFBQWhDO01BRGdCLENBcEJwQjtNQXdCQSxnQkFBQSxFQUFrQixTQUFBO2VBQ2QsSUFBQyxDQUFBLE9BQU8sQ0FBQyxJQUFULENBQWMsY0FBZCxFQUE4QixJQUFDLENBQUEsT0FBTyxDQUFDLFNBQVMsQ0FBQyxLQUFqRDtNQURjLENBeEJsQjtNQTBCQSxjQUFBLEVBQWdCLFNBQUMsUUFBRDtl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QjtxQkFDdEIsS0FBQyxDQUFBLE9BQU8sQ0FBQyxZQUFULENBQXNCLENBQXRCO1lBSGtCLENBQXRCO1lBS0EsV0FBVyxDQUFDLFlBQVosQ0FBeUIsU0FBQyxDQUFELEVBQUksVUFBSjtjQUNyQixJQUFBLENBQUEsQ0FBYyxVQUFBLElBQWUsUUFBQSxDQUFTLEdBQUcsQ0FBQyxPQUFPLENBQUMsRUFBckIsRUFBeUIsQ0FBQyxDQUFDLE1BQTNCLENBQTdCLENBQUE7QUFBQSx1QkFBQTs7Y0FDQSxDQUFDLENBQUMsY0FBRixDQUFBO3FCQUNBLEtBQUMsQ0FBQSxPQUFPLENBQUMsWUFBVCxDQUFzQixJQUF0QixFQUE0QixJQUE1QixFQUFtQyxDQUFDLENBQUMsV0FBRixHQUFnQixHQUFuRDtZQUhxQixDQUF6QjttQkFNQSxLQUFDLENBQUEsT0FBTyxDQUFDLEdBQVQsQ0FBYSxLQUFDLENBQUEsT0FBTyxDQUFDLEVBQXRCO1VBdEZPO1FBQUEsQ0FBQSxDQUFBLENBQUEsSUFBQSxDQUFYO0FBdUZBLGVBQU87TUF2S0QsQ0FoQ1Y7O0VBRGE7QUFBakIiLCJzb3VyY2VzQ29udGVudCI6WyIjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiMgIENvbG9yIFBpY2tlci9leHRlbnNpb25zOiBIdWVcbiMgIENvbG9yIEh1ZSBjb250cm9sbGVyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gKGNvbG9yUGlja2VyKSAtPlxuICAgICAgICBFbWl0dGVyOiAocmVxdWlyZSAnLi4vbW9kdWxlcy9FbWl0dGVyJykoKVxuXG4gICAgICAgIGVsZW1lbnQ6IG51bGxcbiAgICAgICAgY29udHJvbDogbnVsbFxuICAgICAgICBjYW52YXM6IG51bGxcblxuICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICMgIFV0aWxpdHkgZnVuY3Rpb24gdG8gZ2V0IHRoZSBjdXJyZW50IGh1ZVxuICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICBnZXRIdWU6IC0+XG4gICAgICAgICAgICBpZiAoQGNvbnRyb2wgYW5kIEBjb250cm9sLnNlbGVjdGlvbikgYW5kIEBlbGVtZW50XG4gICAgICAgICAgICAgICAgcmV0dXJuIEBjb250cm9sLnNlbGVjdGlvbi55IC8gQGVsZW1lbnQuZ2V0SGVpZ2h0KCkgKiAzNjBcbiAgICAgICAgICAgIGVsc2UgcmV0dXJuIDBcblxuICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICMgIFNldCB1cCBldmVudHMgYW5kIGhhbmRsaW5nXG4gICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICMgU2VsZWN0aW9uIENoYW5nZWQgZXZlbnRcbiAgICAgICAgZW1pdFNlbGVjdGlvbkNoYW5nZWQ6IC0+XG4gICAgICAgICAgICBARW1pdHRlci5lbWl0ICdzZWxlY3Rpb25DaGFuZ2VkJywgQGNvbnRyb2wuc2VsZWN0aW9uXG4gICAgICAgIG9uU2VsZWN0aW9uQ2hhbmdlZDogKGNhbGxiYWNrKSAtPlxuICAgICAgICAgICAgQEVtaXR0ZXIub24gJ3NlbGVjdGlvbkNoYW5nZWQnLCBjYWxsYmFja1xuXG4gICAgICAgICMgQ29sb3IgQ2hhbmdlZCBldmVudFxuICAgICAgICBlbWl0Q29sb3JDaGFuZ2VkOiAtPlxuICAgICAgICAgICAgQEVtaXR0ZXIuZW1pdCAnY29sb3JDaGFuZ2VkJywgQGNvbnRyb2wuc2VsZWN0aW9uLmNvbG9yXG4gICAgICAgIG9uQ29sb3JDaGFuZ2VkOiAoY2FsbGJhY2spIC0+XG4gICAgICAgICAgICBARW1pdHRlci5vbiAnY29sb3JDaGFuZ2VkJywgY2FsbGJhY2tcblxuICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICMgIENyZWF0ZSBhbmQgYWN0aXZhdGUgSHVlIGNvbnRyb2xsZXJcbiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgYWN0aXZhdGU6IC0+XG4gICAgICAgICAgICBCb2R5ID0gY29sb3JQaWNrZXIuZ2V0RXh0ZW5zaW9uICdCb2R5J1xuXG4gICAgICAgICMgIENyZWF0ZSB0aGUgZWxlbWVudFxuICAgICAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgQGVsZW1lbnQgPVxuICAgICAgICAgICAgICAgIGVsOiBkbyAtPlxuICAgICAgICAgICAgICAgICAgICBfY2xhc3NQcmVmaXggPSBCb2R5LmVsZW1lbnQuZWwuY2xhc3NOYW1lXG4gICAgICAgICAgICAgICAgICAgIF9lbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgJ2RpdidcbiAgICAgICAgICAgICAgICAgICAgX2VsLmNsYXNzTGlzdC5hZGQgXCIjeyBfY2xhc3NQcmVmaXggfS1odWVcIlxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfZWxcbiAgICAgICAgICAgICAgICAjIFV0aWxpdHkgZnVuY3Rpb25zXG4gICAgICAgICAgICAgICAgd2lkdGg6IDBcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IDBcbiAgICAgICAgICAgICAgICBnZXRXaWR0aDogLT4gcmV0dXJuIEB3aWR0aCBvciBAZWwub2Zmc2V0V2lkdGhcbiAgICAgICAgICAgICAgICBnZXRIZWlnaHQ6IC0+IHJldHVybiBAaGVpZ2h0IG9yIEBlbC5vZmZzZXRIZWlnaHRcblxuICAgICAgICAgICAgICAgIHJlY3Q6IG51bGxcbiAgICAgICAgICAgICAgICBnZXRSZWN0OiAtPiByZXR1cm4gQHJlY3Qgb3IgQHVwZGF0ZVJlY3QoKVxuICAgICAgICAgICAgICAgIHVwZGF0ZVJlY3Q6IC0+IEByZWN0ID0gQGVsLmdldENsaWVudFJlY3RzKClbMF1cblxuICAgICAgICAgICAgICAgICMgQWRkIGEgY2hpbGQgb24gdGhlIEh1ZSBlbGVtZW50XG4gICAgICAgICAgICAgICAgYWRkOiAoZWxlbWVudCkgLT5cbiAgICAgICAgICAgICAgICAgICAgQGVsLmFwcGVuZENoaWxkIGVsZW1lbnRcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXNcbiAgICAgICAgICAgIEJvZHkuZWxlbWVudC5hZGQgQGVsZW1lbnQuZWwsIDJcblxuICAgICAgICAjICBVcGRhdGUgZWxlbWVudCByZWN0IHdoZW4gQ29sb3IgUGlja2VyIG9wZW5zXG4gICAgICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICBjb2xvclBpY2tlci5vbk9wZW4gPT5cbiAgICAgICAgICAgICAgICByZXR1cm4gdW5sZXNzIEBlbGVtZW50LnVwZGF0ZVJlY3QoKSBhbmQgX3JlY3QgPSBAZWxlbWVudC5nZXRSZWN0KClcbiAgICAgICAgICAgICAgICBAd2lkdGggPSBfcmVjdC53aWR0aFxuICAgICAgICAgICAgICAgIEBoZWlnaHQgPSBfcmVjdC5oZWlnaHRcblxuICAgICAgICAjICBDcmVhdGUgYW5kIGRyYXcgY2FudmFzXG4gICAgICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICBzZXRUaW1lb3V0ID0+ICMgd2FpdCBmb3IgdGhlIERPTVxuICAgICAgICAgICAgICAgIEh1ZSA9IHRoaXNcblxuICAgICAgICAgICAgICAgICMgUHJlcGFyZSBzb21lIHZhcmlhYmxlc1xuICAgICAgICAgICAgICAgIF9lbGVtZW50V2lkdGggPSBAZWxlbWVudC5nZXRXaWR0aCgpXG4gICAgICAgICAgICAgICAgX2VsZW1lbnRIZWlnaHQgPSBAZWxlbWVudC5nZXRIZWlnaHQoKVxuXG4gICAgICAgICAgICAgICAgIyBSZWQgdGhyb3VnaCBhbGwgdGhlIG1haW4gY29sb3JzIGFuZCBiYWNrIHRvIHJlZFxuICAgICAgICAgICAgICAgIF9oZXhlcyA9IFsnI2YwMCcsICcjZmYwJywgJyMwZjAnLCAnIzBmZicsICcjMDBmJywgJyNmMGYnLCAnI2YwMCddXG5cbiAgICAgICAgICAgICAgICAjIENyZWF0ZSBjYW52YXMgZWxlbWVudFxuICAgICAgICAgICAgICAgIEBjYW52YXMgPVxuICAgICAgICAgICAgICAgICAgICBlbDogZG8gLT5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9lbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgJ2NhbnZhcydcbiAgICAgICAgICAgICAgICAgICAgICAgIF9lbC53aWR0aCA9IF9lbGVtZW50V2lkdGhcbiAgICAgICAgICAgICAgICAgICAgICAgIF9lbC5oZWlnaHQgPSBfZWxlbWVudEhlaWdodFxuICAgICAgICAgICAgICAgICAgICAgICAgX2VsLmNsYXNzTGlzdC5hZGQgXCIjeyBIdWUuZWxlbWVudC5lbC5jbGFzc05hbWUgfS1jYW52YXNcIlxuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2VsXG4gICAgICAgICAgICAgICAgICAgICMgVXRpbGl0eSBmdW5jdGlvbnNcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dDogbnVsbFxuICAgICAgICAgICAgICAgICAgICBnZXRDb250ZXh0OiAtPiBAY29udGV4dCBvciAoQGNvbnRleHQgPSBAZWwuZ2V0Q29udGV4dCAnMmQnKVxuXG4gICAgICAgICAgICAgICAgICAgIGdldENvbG9yQXRQb3NpdGlvbjogKHkpIC0+IHJldHVybiBjb2xvclBpY2tlci5TbWFydENvbG9yLkhTVkFycmF5IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHkgLyBIdWUuZWxlbWVudC5nZXRIZWlnaHQoKSAqIDM2MFxuICAgICAgICAgICAgICAgICAgICAgICAgMTAwXG4gICAgICAgICAgICAgICAgICAgICAgICAxMDBdXG5cbiAgICAgICAgICAgICAgICAjIERyYXcgZ3JhZGllbnRcbiAgICAgICAgICAgICAgICBfY29udGV4dCA9IEBjYW52YXMuZ2V0Q29udGV4dCgpXG5cbiAgICAgICAgICAgICAgICBfc3RlcCA9IDEgLyAoX2hleGVzLmxlbmd0aCAtIDEpXG4gICAgICAgICAgICAgICAgX2dyYWRpZW50ID0gX2NvbnRleHQuY3JlYXRlTGluZWFyR3JhZGllbnQgMCwgMCwgMSwgX2VsZW1lbnRIZWlnaHRcbiAgICAgICAgICAgICAgICBfZ3JhZGllbnQuYWRkQ29sb3JTdG9wIChfc3RlcCAqIF9pKSwgX2hleCBmb3IgX2hleCwgX2kgaW4gX2hleGVzXG5cbiAgICAgICAgICAgICAgICBfY29udGV4dC5maWxsU3R5bGUgPSBfZ3JhZGllbnRcbiAgICAgICAgICAgICAgICBfY29udGV4dC5maWxsUmVjdCAwLCAwLCBfZWxlbWVudFdpZHRoLCBfZWxlbWVudEhlaWdodFxuXG4gICAgICAgICAgICAgICAgIyBBZGQgdG8gSHVlIGVsZW1lbnRcbiAgICAgICAgICAgICAgICBAZWxlbWVudC5hZGQgQGNhbnZhcy5lbFxuXG4gICAgICAgICMgIENyZWF0ZSBIdWUgY29udHJvbCBlbGVtZW50XG4gICAgICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICBzZXRUaW1lb3V0ID0+ICMgd2FpdCBmb3IgdGhlIERPTVxuICAgICAgICAgICAgICAgIGhhc0NoaWxkID0gKGVsZW1lbnQsIGNoaWxkKSAtPlxuICAgICAgICAgICAgICAgICAgICBpZiBjaGlsZCBhbmQgX3BhcmVudCA9IGNoaWxkLnBhcmVudE5vZGVcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoaWxkIGlzIGVsZW1lbnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gaGFzQ2hpbGQgZWxlbWVudCwgX3BhcmVudFxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcblxuICAgICAgICAgICAgICAgICMgQ3JlYXRlIGVsZW1lbnRcbiAgICAgICAgICAgICAgICBIdWUgPSB0aGlzXG5cbiAgICAgICAgICAgICAgICBAY29udHJvbCA9XG4gICAgICAgICAgICAgICAgICAgIGVsOiBkbyAtPlxuICAgICAgICAgICAgICAgICAgICAgICAgX2VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCAnZGl2J1xuICAgICAgICAgICAgICAgICAgICAgICAgX2VsLmNsYXNzTGlzdC5hZGQgXCIjeyBIdWUuZWxlbWVudC5lbC5jbGFzc05hbWUgfS1jb250cm9sXCJcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9lbFxuICAgICAgICAgICAgICAgICAgICBpc0dyYWJiaW5nOiBub1xuXG4gICAgICAgICAgICAgICAgICAgICMgU2V0IGNvbnRyb2wgc2VsZWN0aW9uXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGlvbjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHk6IDBcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBudWxsXG4gICAgICAgICAgICAgICAgICAgIHNldFNlbGVjdGlvbjogKGUsIHk9bnVsbCwgb2Zmc2V0PW51bGwpIC0+XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW5sZXNzIEh1ZS5jYW52YXMgYW5kIF9yZWN0ID0gSHVlLmVsZW1lbnQuZ2V0UmVjdCgpXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIF93aWR0aCA9IEh1ZS5lbGVtZW50LmdldFdpZHRoKClcbiAgICAgICAgICAgICAgICAgICAgICAgIF9oZWlnaHQgPSBIdWUuZWxlbWVudC5nZXRIZWlnaHQoKVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiBlIHRoZW4gX3kgPSBlLnBhZ2VZIC0gX3JlY3QudG9wXG4gICAgICAgICAgICAgICAgICAgICAgICAjIFNldCB0aGUgeSBkaXJlY3RseVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHkgaXMgJ251bWJlcicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3kgPSB5XG4gICAgICAgICAgICAgICAgICAgICAgICAjIEhhbmRsZSBzY3JvbGxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBvZmZzZXQgaXMgJ251bWJlcicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3kgPSBAc2VsZWN0aW9uLnkgKyBvZmZzZXRcbiAgICAgICAgICAgICAgICAgICAgICAgICMgRGVmYXVsdCB0byB0b3BcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgX3kgPSBAc2VsZWN0aW9uLnlcblxuICAgICAgICAgICAgICAgICAgICAgICAgX3kgPSBAc2VsZWN0aW9uLnkgPSBNYXRoLm1heCAwLCAoTWF0aC5taW4gX2hlaWdodCwgX3kpXG4gICAgICAgICAgICAgICAgICAgICAgICBAc2VsZWN0aW9uLmNvbG9yID0gSHVlLmNhbnZhcy5nZXRDb2xvckF0UG9zaXRpb24gX3lcblxuICAgICAgICAgICAgICAgICAgICAgICAgX3Bvc2l0aW9uID0geTogTWF0aC5tYXggMywgKE1hdGgubWluIChfaGVpZ2h0IC0gNiksIF95KVxuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBAZWwuc3R5bGUudG9wID0gXCIjeyBfcG9zaXRpb24ueSB9cHhcIlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEh1ZS5lbWl0U2VsZWN0aW9uQ2hhbmdlZCgpXG5cbiAgICAgICAgICAgICAgICAgICAgcmVmcmVzaFNlbGVjdGlvbjogLT4gQHNldFNlbGVjdGlvbigpXG4gICAgICAgICAgICAgICAgQGNvbnRyb2wucmVmcmVzaFNlbGVjdGlvbigpXG5cbiAgICAgICAgICAgICAgICAjIElmIHRoZSBDb2xvciBQaWNrZXIgaXMgZmVkIGEgY29sb3IsIHNldCBpdFxuICAgICAgICAgICAgICAgIGNvbG9yUGlja2VyLm9uSW5wdXRDb2xvciAoc21hcnRDb2xvcikgPT5cbiAgICAgICAgICAgICAgICAgICAgX2h1ZSA9IHNtYXJ0Q29sb3IudG9IU1ZBcnJheSgpWzBdXG4gICAgICAgICAgICAgICAgICAgIEBjb250cm9sLnNldFNlbGVjdGlvbiBudWxsLCAoQGVsZW1lbnQuZ2V0SGVpZ2h0KCkgLyAzNjApICogX2h1ZVxuXG4gICAgICAgICAgICAgICAgIyBXaGVuIHRoZSBzZWxlY3Rpb24gY2hhbmdlcywgdGhlIGNvbG9yIGhhcyBjaGFuZ2VkXG4gICAgICAgICAgICAgICAgSHVlLm9uU2VsZWN0aW9uQ2hhbmdlZCAtPiBIdWUuZW1pdENvbG9yQ2hhbmdlZCgpXG5cbiAgICAgICAgICAgICAgICAjIFJlc2V0XG4gICAgICAgICAgICAgICAgY29sb3JQaWNrZXIub25PcGVuID0+IEBjb250cm9sLnJlZnJlc2hTZWxlY3Rpb24oKVxuICAgICAgICAgICAgICAgIGNvbG9yUGlja2VyLm9uT3BlbiA9PiBAY29udHJvbC5pc0dyYWJiaW5nID0gbm9cbiAgICAgICAgICAgICAgICBjb2xvclBpY2tlci5vbkNsb3NlID0+IEBjb250cm9sLmlzR3JhYmJpbmcgPSBub1xuXG4gICAgICAgICAgICAgICAgIyBCaW5kIGNvbnRyb2xsZXIgZXZlbnRzXG4gICAgICAgICAgICAgICAgY29sb3JQaWNrZXIub25Nb3VzZURvd24gKGUsIGlzT25QaWNrZXIpID0+XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmxlc3MgaXNPblBpY2tlciBhbmQgaGFzQ2hpbGQgSHVlLmVsZW1lbnQuZWwsIGUudGFyZ2V0XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgICAgICAgICAgICAgICBAY29udHJvbC5pc0dyYWJiaW5nID0geWVzXG4gICAgICAgICAgICAgICAgICAgIEBjb250cm9sLnNldFNlbGVjdGlvbiBlXG5cbiAgICAgICAgICAgICAgICBjb2xvclBpY2tlci5vbk1vdXNlTW92ZSAoZSkgPT5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVubGVzcyBAY29udHJvbC5pc0dyYWJiaW5nXG4gICAgICAgICAgICAgICAgICAgIEBjb250cm9sLnNldFNlbGVjdGlvbiBlXG5cbiAgICAgICAgICAgICAgICBjb2xvclBpY2tlci5vbk1vdXNlVXAgKGUpID0+XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmxlc3MgQGNvbnRyb2wuaXNHcmFiYmluZ1xuICAgICAgICAgICAgICAgICAgICBAY29udHJvbC5pc0dyYWJiaW5nID0gbm9cbiAgICAgICAgICAgICAgICAgICAgQGNvbnRyb2wuc2V0U2VsZWN0aW9uIGVcblxuICAgICAgICAgICAgICAgIGNvbG9yUGlja2VyLm9uTW91c2VXaGVlbCAoZSwgaXNPblBpY2tlcikgPT5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVubGVzcyBpc09uUGlja2VyIGFuZCBoYXNDaGlsZCBIdWUuZWxlbWVudC5lbCwgZS50YXJnZXRcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgICAgICAgICAgIEBjb250cm9sLnNldFNlbGVjdGlvbiBudWxsLCBudWxsLCAoZS53aGVlbERlbHRhWSAqIC4zMykgIyBtYWtlIGl0IGEgYml0IHNvZnRlclxuXG4gICAgICAgICAgICAgICAgIyBBZGQgdG8gSHVlIGVsZW1lbnRcbiAgICAgICAgICAgICAgICBAZWxlbWVudC5hZGQgQGNvbnRyb2wuZWxcbiAgICAgICAgICAgIHJldHVybiB0aGlzXG4iXX0=
