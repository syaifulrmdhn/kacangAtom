(function() {
  module.exports = function(colorPicker) {
    return {
      Emitter: (require('../modules/Emitter'))(),
      element: null,
      color: null,
      emitVisibility: function(visible) {
        if (visible == null) {
          visible = true;
        }
        return this.Emitter.emit('visible', visible);
      },
      onVisibility: function(callback) {
        return this.Emitter.on('visible', callback);
      },
      activate: function() {
        var View, _isClicking, hasChild;
        View = this;
        this.element = {
          el: (function() {
            var _classPrefix, _el;
            _classPrefix = colorPicker.element.el.className;
            _el = document.createElement('div');
            _el.classList.add(_classPrefix + "-return");
            return _el;
          })(),
          addClass: function(className) {
            this.el.classList.add(className);
            return this;
          },
          removeClass: function(className) {
            this.el.classList.remove(className);
            return this;
          },
          hasClass: function(className) {
            return this.el.classList.contains(className);
          },
          hide: function() {
            this.removeClass('is--visible');
            return View.emitVisibility(false);
          },
          show: function() {
            this.addClass('is--visible');
            return View.emitVisibility(true);
          },
          add: function(element) {
            this.el.appendChild(element);
            return this;
          },
          setColor: function(smartColor) {
            return this.el.style.backgroundColor = smartColor.toRGBA();
          }
        };
        colorPicker.element.add(this.element.el);
        hasChild = function(element, child) {
          var _parent;
          if (child && (_parent = child.parentNode)) {
            if (child === element) {
              return true;
            } else {
              return hasChild(element, _parent);
            }
          }
          return false;
        };
        _isClicking = false;
        colorPicker.onMouseDown((function(_this) {
          return function(e, isOnPicker) {
            if (!(isOnPicker && hasChild(_this.element.el, e.target))) {
              return;
            }
            e.preventDefault();
            return _isClicking = true;
          };
        })(this));
        colorPicker.onMouseMove(function(e) {
          return _isClicking = false;
        });
        colorPicker.onMouseUp((function(_this) {
          return function(e) {
            if (!(_isClicking && _this.color)) {
              return;
            }
            return colorPicker.emitInputColor(_this.color);
          };
        })(this));
        setTimeout((function(_this) {
          return function() {
            var Alpha;
            Alpha = colorPicker.getExtension('Alpha');
            colorPicker.onBeforeOpen(function() {
              return _this.color = null;
            });
            colorPicker.onInputColor(function(smartColor, wasFound) {
              if (wasFound) {
                return _this.color = smartColor;
              }
            });
            Alpha.onColorChanged(function(smartColor) {
              if (!_this.color) {
                return _this.element.hide();
              }
              if (smartColor.equals(_this.color)) {
                return _this.element.hide();
              } else {
                return _this.element.show();
              }
            });
          };
        })(this));
        setTimeout((function(_this) {
          return function() {
            colorPicker.onInputColor(function(smartColor, wasFound) {
              if (wasFound) {
                return _this.element.setColor(smartColor);
              }
            });
          };
        })(this));
        setTimeout((function(_this) {
          return function() {
            var _text, setColor;
            _text = document.createElement('p');
            _text.classList.add(_this.element.el.className + "-text");
            setColor = function(smartColor) {
              return _text.innerText = smartColor.value;
            };
            colorPicker.onInputColor(function(smartColor, wasFound) {
              if (wasFound) {
                return setColor(smartColor);
              }
            });
            return _this.element.add(_text);
          };
        })(this));
        return this;
      }
    };
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiL2hvbWUvc3lhaWYvLmF0b20vcGFja2FnZXMvY29sb3ItcGlja2VyL2xpYi9leHRlbnNpb25zL1JldHVybi5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBTUk7RUFBQSxNQUFNLENBQUMsT0FBUCxHQUFpQixTQUFDLFdBQUQ7V0FDYjtNQUFBLE9BQUEsRUFBUyxDQUFDLE9BQUEsQ0FBUSxvQkFBUixDQUFELENBQUEsQ0FBQSxDQUFUO01BRUEsT0FBQSxFQUFTLElBRlQ7TUFHQSxLQUFBLEVBQU8sSUFIUDtNQVNBLGNBQUEsRUFBZ0IsU0FBQyxPQUFEOztVQUFDLFVBQVE7O2VBQ3JCLElBQUMsQ0FBQSxPQUFPLENBQUMsSUFBVCxDQUFjLFNBQWQsRUFBeUIsT0FBekI7TUFEWSxDQVRoQjtNQVdBLFlBQUEsRUFBYyxTQUFDLFFBQUQ7ZUFDVixJQUFDLENBQUEsT0FBTyxDQUFDLEVBQVQsQ0FBWSxTQUFaLEVBQXVCLFFBQXZCO01BRFUsQ0FYZDtNQWlCQSxRQUFBLEVBQVUsU0FBQTtBQUNOLFlBQUE7UUFBQSxJQUFBLEdBQU87UUFJUCxJQUFDLENBQUEsT0FBRCxHQUNJO1VBQUEsRUFBQSxFQUFPLENBQUEsU0FBQTtBQUNILGdCQUFBO1lBQUEsWUFBQSxHQUFlLFdBQVcsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO1lBQ3RDLEdBQUEsR0FBTSxRQUFRLENBQUMsYUFBVCxDQUF1QixLQUF2QjtZQUNOLEdBQUcsQ0FBQyxTQUFTLENBQUMsR0FBZCxDQUFzQixZQUFGLEdBQWdCLFNBQXBDO0FBRUEsbUJBQU87VUFMSixDQUFBLENBQUgsQ0FBQSxDQUFKO1VBT0EsUUFBQSxFQUFVLFNBQUMsU0FBRDtZQUFlLElBQUMsQ0FBQSxFQUFFLENBQUMsU0FBUyxDQUFDLEdBQWQsQ0FBa0IsU0FBbEI7QUFBNkIsbUJBQU87VUFBbkQsQ0FQVjtVQVFBLFdBQUEsRUFBYSxTQUFDLFNBQUQ7WUFBZSxJQUFDLENBQUEs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Q0FBQSxPQUFPLENBQUMsSUFBVCxDQUFBLEVBREo7ZUFBQSxNQUFBO3VCQUVLLEtBQUMsQ0FBQSxPQUFPLENBQUMsSUFBVCxDQUFBLEVBRkw7O1lBSGlCLENBQXJCO1VBWk87UUFBQSxDQUFBLENBQUEsQ0FBQSxJQUFBLENBQVg7UUFzQkEsVUFBQSxDQUFXLENBQUEsU0FBQSxLQUFBO2lCQUFBLFNBQUE7WUFDUCxXQUFXLENBQUMsWUFBWixDQUF5QixTQUFDLFVBQUQsRUFBYSxRQUFiO2NBQ3JCLElBQWdDLFFBQWhDO3VCQUFBLEtBQUMsQ0FBQSxPQUFPLENBQUMsUUFBVCxDQUFrQixVQUFsQixFQUFBOztZQURxQixDQUF6QjtVQURPO1FBQUEsQ0FBQSxDQUFBLENBQUEsSUFBQSxDQUFYO1FBT0EsVUFBQSxDQUFXLENBQUEsU0FBQSxLQUFBO2lCQUFBLFNBQUE7QUFFUCxnQkFBQTtZQUFBLEtBQUEsR0FBUSxRQUFRLENBQUMsYUFBVCxDQUF1QixHQUF2QjtZQUNSLEtBQUssQ0FBQyxTQUFTLENBQUMsR0FBaEIsQ0FBd0IsS0FBQyxDQUFBLE9BQU8sQ0FBQyxFQUFFLENBQUMsU0FBZCxHQUF5QixPQUEvQztZQUdBLFFBQUEsR0FBVyxTQUFDLFVBQUQ7cUJBQ1AsS0FBSyxDQUFDLFNBQU4sR0FBa0IsVUFBVSxDQUFDO1lBRHRCO1lBR1gsV0FBVyxDQUFDLFlBQVosQ0FBeUIsU0FBQyxVQUFELEVBQWEsUUFBYjtjQUNyQixJQUF1QixRQUF2Qjt1QkFBQSxRQUFBLENBQVMsVUFBVCxFQUFBOztZQURxQixDQUF6QjttQkFFQSxLQUFDLENBQUEsT0FBTyxDQUFDLEdBQVQsQ0FBYSxLQUFiO1VBWE87UUFBQSxDQUFBLENBQUEsQ0FBQSxJQUFBLENBQVg7QUFZQSxlQUFPO01BaEdELENBakJWOztFQURhO0FBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4jICBDb2xvciBQaWNrZXIvZXh0ZW5zaW9uczogUmV0dXJuXG4jICBUaGUgZWxlbWVudCBzaG93aW5nIHRoZSBpbml0aWFsIGNvbG9yIHZhbHVlLCBlbmFibGluZyB0aGUgdXNlciB0byByZXR1cm5cbiMgIHRvIGl0IGF0IGFueSB0aW1lXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gKGNvbG9yUGlja2VyKSAtPlxuICAgICAgICBFbWl0dGVyOiAocmVxdWlyZSAnLi4vbW9kdWxlcy9FbWl0dGVyJykoKVxuXG4gICAgICAgIGVsZW1lbnQ6IG51bGxcbiAgICAgICAgY29sb3I6IG51bGxcblxuICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICMgIFNldCB1cCBldmVudHMgYW5kIGhhbmRsaW5nXG4gICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICMgVmlzaWJpbGl0eSBldmVudFxuICAgICAgICBlbWl0VmlzaWJpbGl0eTogKHZpc2libGU9dHJ1ZSkgLT5cbiAgICAgICAgICAgIEBFbWl0dGVyLmVtaXQgJ3Zpc2libGUnLCB2aXNpYmxlXG4gICAgICAgIG9uVmlzaWJpbGl0eTogKGNhbGxiYWNrKSAtPlxuICAgICAgICAgICAgQEVtaXR0ZXIub24gJ3Zpc2libGUnLCBjYWxsYmFja1xuXG4gICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgIyAgQ3JlYXRlIGFuZCBhY3RpdmF0ZSBSZXR1cm4gZWxlbWVudFxuICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICBhY3RpdmF0ZTogLT5cbiAgICAgICAgICAgIFZpZXcgPSB0aGlzXG5cbiAgICAgICAgIyAgQnVpbGQgdGhlIGVsZW1lbnRcbiAgICAgICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIEBlbGVtZW50ID1cbiAgICAgICAgICAgICAgICBlbDogZG8gLT5cbiAgICAgICAgICAgICAgICAgICAgX2NsYXNzUHJlZml4ID0gY29sb3JQaWNrZXIuZWxlbWVudC5lbC5jbGFzc05hbWVcbiAgICAgICAgICAgICAgICAgICAgX2VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCAnZGl2J1xuICAgICAgICAgICAgICAgICAgICBfZWwuY2xhc3NMaXN0LmFkZCBcIiN7IF9jbGFzc1ByZWZpeCB9LXJldHVyblwiXG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9lbFxuICAgICAgICAgICAgICAgICMgVXRpbGl0eSBmdW5jdGlvbnNcbiAgICAgICAgICAgICAgICBhZGRDbGFzczogKGNsYXNzTmFtZSkgLT4gQGVsLmNsYXNzTGlzdC5hZGQgY2xhc3NOYW1lOyByZXR1cm4gdGhpc1xuICAgICAgICAgICAgICAgIHJlbW92ZUNsYXNzOiAoY2xhc3NOYW1lKSAtPiBAZWwuY2xhc3NMaXN0LnJlbW92ZSBjbGFzc05hbWU7IHJldHVybiB0aGlzXG4gICAgICAgICAgICAgICAgaGFzQ2xhc3M6IChjbGFzc05hbWUpIC0+IEBlbC5jbGFzc0xpc3QuY29udGFpbnMgY2xhc3NOYW1lXG5cbiAgICAgICAgICAgICAgICBoaWRlOiAtPiBAcmVtb3ZlQ2xhc3MgJ2lzLS12aXNpYmxlJzsgVmlldy5lbWl0VmlzaWJpbGl0eSBmYWxzZVxuICAgICAgICAgICAgICAgIHNob3c6IC0+IEBhZGRDbGFzcyAnaXMtLXZpc2libGUnOyBWaWV3LmVtaXRWaXNpYmlsaXR5IHRydWVcblxuICAgICAgICAgICAgICAgICMgQWRkIGEgY2hpbGQgb24gdGhlIFJldHVybiBlbGVtZW50XG4gICAgICAgICAgICAgICAgYWRkOiAoZWxlbWVudCkgLT5cbiAgICAgICAgICAgICAgICAgICAgQGVsLmFwcGVuZENoaWxkIGVsZW1lbnRcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXNcblxuICAgICAgICAgICAgICAgICMgU2V0IHRoZSBSZXR1cm4gZWxlbWVudCBiYWNrZ3JvdW5kIGNvbG9yXG4gICAgICAgICAgICAgICAgc2V0Q29sb3I6IChzbWFydENvbG9yKSAtPlxuICAgICAgICAgICAgICAgICAgICBAZWwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gc21hcnRDb2xvci50b1JHQkEoKVxuICAgICAgICAgICAgY29sb3JQaWNrZXIuZWxlbWVudC5hZGQgQGVsZW1lbnQuZWxcblxuICAgICAgICAjICBSZXR1cm4gY29sb3Igb24gY2xpY2tcbiAgICAgICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIGhhc0NoaWxkID0gKGVsZW1lbnQsIGNoaWxkKSAtPlxuICAgICAgICAgICAgICAgIGlmIGNoaWxkIGFuZCBfcGFyZW50ID0gY2hpbGQucGFyZW50Tm9kZVxuICAgICAgICAgICAgICAgICAgICBpZiBjaGlsZCBpcyBlbGVtZW50XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHJldHVybiBoYXNDaGlsZCBlbGVtZW50LCBfcGFyZW50XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG5cbiAgICAgICAgICAgIF9pc0NsaWNraW5nID0gbm9cblxuICAgICAgICAgICAgY29sb3JQaWNrZXIub25Nb3VzZURvd24gKGUsIGlzT25QaWNrZXIpID0+XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVubGVzcyBpc09uUGlja2VyIGFuZCBoYXNDaGlsZCBAZWxlbWVudC5lbCwgZS50YXJnZXRcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgICAgICAgICBfaXNDbGlja2luZyA9IHllc1xuXG4gICAgICAgICAgICBjb2xvclBpY2tlci5vbk1vdXNlTW92ZSAoZSkgLT5cbiAgICAgICAgICAgICAgICBfaXNDbGlja2luZyA9IG5vXG5cbiAgICAgICAgICAgIGNvbG9yUGlja2VyLm9uTW91c2VVcCAoZSkgPT5cbiAgICAgICAgICAgICAgICByZXR1cm4gdW5sZXNzIF9pc0NsaWNraW5nIGFuZCBAY29sb3JcbiAgICAgICAgICAgICAgICBjb2xvclBpY2tlci5lbWl0SW5wdXRDb2xvciBAY29sb3JcblxuICAgICAgICAjICBTaG93IHRoZSBlbGVtZW50IHdoZW4gdGhlIGlucHV0IGNvbG9yIGlzbid0IHRoZSBjdXJyZW50IGNvbG9yXG4gICAgICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICBzZXRUaW1lb3V0ID0+XG4gICAgICAgICAgICAgICAgQWxwaGEgPSBjb2xvclBpY2tlci5nZXRFeHRlbnNpb24gJ0FscGhhJ1xuXG4gICAgICAgICAgICAgICAgIyBSZXNldCBvbiBjb2xvclBpY2tlciBvcGVuXG4gICAgICAgICAgICAgICAgY29sb3JQaWNrZXIub25CZWZvcmVPcGVuID0+XG4gICAgICAgICAgICAgICAgICAgIEBjb2xvciA9IG51bGxcblxuICAgICAgICAgICAgICAgICMgU2F2ZSB0aGUgY3VycmVudCBjb2xvclxuICAgICAgICAgICAgICAgIGNvbG9yUGlja2VyLm9uSW5wdXRDb2xvciAoc21hcnRDb2xvciwgd2FzRm91bmQpID0+XG4gICAgICAgICAgICAgICAgICAgIEBjb2xvciA9IHNtYXJ0Q29sb3IgaWYgd2FzRm91bmRcblxuICAgICAgICAgICAgICAgICMgRG8gdGhlIGNoZWNrIG9uIEFscGhhIGNoYW5nZVxuICAgICAgICAgICAgICAgIEFscGhhLm9uQ29sb3JDaGFuZ2VkIChzbWFydENvbG9yKSA9PlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gQGVsZW1lbnQuaGlkZSgpIHVubGVzcyBAY29sb3JcblxuICAgICAgICAgICAgICAgICAgICBpZiBzbWFydENvbG9yLmVxdWFscyBAY29sb3JcbiAgICAgICAgICAgICAgICAgICAgICAgIEBlbGVtZW50LmhpZGUoKVxuICAgICAgICAgICAgICAgICAgICBlbHNlIEBlbGVtZW50LnNob3coKVxuICAgICAgICAgICAgICAgIHJldHVyblxuXG4gICAgICAgICMgIFNldCBiYWNrZ3JvdW5kIGVsZW1lbnQgY29sb3Igb24gaW5wdXQgY29sb3JcbiAgICAgICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIHNldFRpbWVvdXQgPT5cbiAgICAgICAgICAgICAgICBjb2xvclBpY2tlci5vbklucHV0Q29sb3IgKHNtYXJ0Q29sb3IsIHdhc0ZvdW5kKSA9PlxuICAgICAgICAgICAgICAgICAgICBAZWxlbWVudC5zZXRDb2xvciBzbWFydENvbG9yIGlmIHdhc0ZvdW5kXG4gICAgICAgICAgICAgICAgcmV0dXJuXG5cbiAgICAgICAgIyAgQ3JlYXRlIFJldHVybiB0ZXh0IGVsZW1lbnRcbiAgICAgICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIHNldFRpbWVvdXQgPT5cbiAgICAgICAgICAgICAgICAjIENyZWF0ZSB0ZXh0IGVsZW1lbnRcbiAgICAgICAgICAgICAgICBfdGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgJ3AnXG4gICAgICAgICAgICAgICAgX3RleHQuY2xhc3NMaXN0LmFkZCBcIiN7IEBlbGVtZW50LmVsLmNsYXNzTmFtZSB9LXRleHRcIlxuXG4gICAgICAgICAgICAgICAgIyBTZXQgdGhlIHRleHQgZWxlbWVudCB0byBjb250YWluIHRoZSBSZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgIHNldENvbG9yID0gKHNtYXJ0Q29sb3IpID0+XG4gICAgICAgICAgICAgICAgICAgIF90ZXh0LmlubmVyVGV4dCA9IHNtYXJ0Q29sb3IudmFsdWVcblxuICAgICAgICAgICAgICAgIGNvbG9yUGlja2VyLm9uSW5wdXRDb2xvciAoc21hcnRDb2xvciwgd2FzRm91bmQpIC0+XG4gICAgICAgICAgICAgICAgICAgIHNldENvbG9yIHNtYXJ0Q29sb3IgaWYgd2FzRm91bmRcbiAgICAgICAgICAgICAgICBAZWxlbWVudC5hZGQgX3RleHRcbiAgICAgICAgICAgIHJldHVybiB0aGlzXG4iXX0=
