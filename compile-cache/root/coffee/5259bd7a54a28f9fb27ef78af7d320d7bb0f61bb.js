(function() {
  module.exports = function(colorPicker) {
    return {
      Emitter: (require('../modules/Emitter'))(),
      element: null,
      control: null,
      canvas: null,
      emitSelectionChanged: function() {
        return this.Emitter.emit('selectionChanged', this.control.selection);
      },
      onSelectionChanged: function(callback) {
        return this.Emitter.on('selectionChanged', callback);
      },
      emitColorChanged: function() {
        return this.Emitter.emit('colorChanged', this.control.selection.color);
      },
      onColorChanged: function(callback) {
        return this.Emitter.on('colorChanged', callback);
      },
      activate: function() {
        var Body;
        Body = colorPicker.getExtension('Body');
        this.element = {
          el: (function() {
            var _classPrefix, _el;
            _classPrefix = Body.element.el.className;
            _el = document.createElement('div');
            _el.classList.add(_classPrefix + "-alpha");
            return _el;
          })(),
          width: 0,
          height: 0,
          getWidth: function() {
            return this.width || this.el.offsetWidth;
          },
          getHeight: function() {
            return this.height || this.el.offsetHeight;
          },
          rect: null,
          getRect: function() {
            return this.rect || this.updateRect();
          },
          updateRect: function() {
            return this.rect = this.el.getClientRects()[0];
          },
          add: function(element) {
            this.el.appendChild(element);
            return this;
          }
        };
        Body.element.add(this.element.el, 1);
        colorPicker.onOpen((function(_this) {
          return function() {
            return _this.element.updateRect();
          };
        })(this));
        setTimeout((function(_this) {
          return function() {
            var Alpha, Saturation, _elementHeight, _elementWidth;
            Alpha = _this;
            Saturation = colorPicker.getExtension('Saturation');
            _elementWidth = _this.element.getWidth();
            _elementHeight = _this.element.getHeight();
            _this.canvas = {
              el: (function() {
                var _el;
                _el = document.createElement('canvas');
                _el.width = _elementWidth;
                _el.height = _elementHeight;
                _el.classList.add(Alpha.element.el.className + "-canvas");
                return _el;
              })(),
              context: null,
              getContext: function() {
                return this.context || (this.context = this.el.getContext('2d'));
              },
              previousRender: null,
              render: function(smartColor) {
                var _context, _gradient, _rgb;
                _rgb = ((function() {
                  if (!smartColor) {
                    return colorPicker.SmartColor.HEX('#f00');
                  } else {
                    return smartColor;
                  }
                })()).toRGBArray().join(',');
                if (this.previousRender && this.previousRender === _rgb) {
                  return;
                }
                _context = this.getContext();
                _context.clearRect(0, 0, _elementWidth, _elementHeight);
                _gradient = _context.createLinearGradient(0, 0, 1, _elementHeight);
                _gradient.addColorStop(.01, "rgba(" + _rgb + ",1)");
                _gradient.addColorStop(.99, "rgba(" + _rgb + ",0)");
                _context.fillStyle = _gradient;
                _context.fillRect(0, 0, _elementWidth, _elementHeight);
                return this.previousRender = _rgb;
              }
            };
            Saturation.onColorChanged(function(smartColor) {
              return _this.canvas.render(smartColor);
            });
            _this.canvas.render();
            return _this.element.add(_this.canvas.el);
          };
        })(this));
        setTimeout((function(_this) {
          return function() {
            var Alpha, Saturation, hasChild;
            hasChild = function(element, child) {
              var _parent;
              if (child && (_parent = child.parentNode)) {
                if (child === element) {
                  return true;
                } else {
                  return hasChild(element, _parent);
                }
              }
              return false;
            };
            Alpha = _this;
            Saturation = colorPicker.getExtension('Saturation');
            _this.control = {
              el: (function() {
                var _el;
                _el = document.createElement('div');
                _el.classList.add(Alpha.element.el.className + "-control");
                return _el;
              })(),
              isGrabbing: false,
              previousControlPosition: null,
              updateControlPosition: function(y) {
                var _joined;
                _joined = "," + y;
                if (this.previousControlPosition && this.previousControlPosition === _joined) {
                  return;
                }
                requestAnimationFrame((function(_this) {
                  return function() {
                    return _this.el.style.top = y + "px";
                  };
                })(this));
                return this.previousControlPosition = _joined;
              },
              selection: {
                y: 0,
                color: null,
                alpha: null
              },
              setSelection: function(e, alpha, offset) {
                var _RGBAArray, _alpha, _height, _position, _rect, _smartColor, _width, _y;
                if (alpha == null) {
                  alpha = null;
                }
                if (offset == null) {
                  offset = null;
                }
                _rect = Alpha.element.getRect();
                _width = Alpha.element.getWidth();
                _height = Alpha.element.getHeight();
                if (e) {
                  _y = e.pageY - _rect.top;
                } else if (typeof alpha === 'number') {
                  _y = _height - (alpha * _height);
                } else if (typeof offset === 'number') {
                  _y = this.selection.y + offset;
                } else {
                  _y = this.selection.y;
                }
                _y = this.selection.y = Math.max(0, Math.min(_height, _y));
                _alpha = 1 - (_y / _height);
                this.selection.alpha = (Math.round(_alpha * 100)) / 100;
                if (_smartColor = this.selection.color) {
                  _RGBAArray = _smartColor.toRGBAArray();
                  _RGBAArray[3] = this.selection.alpha;
                  this.selection.color = colorPicker.SmartColor.RGBAArray(_RGBAArray);
                  Alpha.emitColorChanged();
                } else {
                  this.selection.color = colorPicker.SmartColor.RGBAArray([255, 0, 0, this.selection.alpha]);
                }
                _position = {
                  y: Math.max(3, Math.min(_height - 6, _y))
                };
                this.updateControlPosition(_position.y);
                return Alpha.emitSelectionChanged();
              },
              refreshSelection: function() {
                return this.setSelection();
              }
            };
            _this.control.refreshSelection();
            colorPicker.onInputColor(function(smartColor) {
              return _this.control.setSelection(null, smartColor.getAlpha());
            });
            colorPicker.onOpen(function() {
              return _this.control.isGrabbing = false;
            });
            colorPicker.onClose(function() {
              return _this.control.isGrabbing = false;
            });
            Saturation.onColorChanged(function(smartColor) {
              _this.control.selection.color = smartColor;
              return _this.control.refreshSelection();
            });
            colorPicker.onMouseDown(function(e, isOnPicker) {
              if (!(isOnPicker && hasChild(Alpha.element.el, e.target))) {
                return;
              }
              e.preventDefault();
              _this.control.isGrabbing = true;
              return _this.control.setSelection(e);
            });
            colorPicker.onMouseMove(function(e) {
              if (!_this.control.isGrabbing) {
                return;
              }
              return _this.control.setSelection(e);
            });
            colorPicker.onMouseUp(function(e) {
              if (!_this.control.isGrabbing) {
                return;
              }
              _this.control.isGrabbing = false;
              return _this.control.setSelection(e);
            });
            colorPicker.onMouseWheel(function(e, isOnPicker) {
              if (!(isOnPicker && hasChild(Alpha.element.el, e.target))) {
                return;
              }
              e.preventDefault();
              return _this.control.setSelection(null, null, e.wheelDeltaY * .33);
            });
            return _this.element.add(_this.control.el);
          };
        })(this));
        return this;
      }
    };
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiL2hvbWUvc3lhaWYvLmF0b20vcGFja2FnZXMvY29sb3ItcGlja2VyL2xpYi9leHRlbnNpb25zL0FscGhhLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFLSTtFQUFBLE1BQU0sQ0FBQyxPQUFQLEdBQWlCLFNBQUMsV0FBRDtXQUNiO01BQUEsT0FBQSxFQUFTLENBQUMsT0FBQSxDQUFRLG9CQUFSLENBQUQsQ0FBQSxDQUFBLENBQVQ7TUFFQSxPQUFBLEVBQVMsSUFGVDtNQUdBLE9BQUEsRUFBUyxJQUhUO01BSUEsTUFBQSxFQUFRLElBSlI7TUFVQSxvQkFBQSxFQUFzQixTQUFBO2VBQ2xCLElBQUMsQ0FBQSxPQUFPLENBQUMsSUFBVCxDQUFjLGtCQUFkLEVBQWtDLElBQUMsQ0FBQSxPQUFPLENBQUMsU0FBM0M7TUFEa0IsQ0FWdEI7TUFZQSxrQkFBQSxFQUFvQixTQUFDLFFBQUQ7ZUFDaEIsSUFBQyxDQUFBLE9BQU8sQ0FBQyxFQUFULENBQVksa0JBQVosRUFBZ0MsUUFBaEM7TUFEZ0IsQ0FacEI7TUFnQkEsZ0JBQUEsRUFBa0IsU0FBQTtlQUNkLElBQUMsQ0FBQSxPQUFPLENBQUMsSUFBVCxDQUFjLGNBQWQsRUFBOEIsSUFBQyxDQUFBLE9BQU8sQ0FBQyxTQUFTLENBQUMsS0FBakQ7TUFEYyxDQWhCbEI7TUFrQkEsY0FBQSxFQUFnQixTQUFDLFFBQUQ7ZUFDWixJQUFDLENBQUEsT0FBTyxDQUFDLEVBQVQsQ0FBWSxjQUFaLEVBQTRCLFFBQTVCO01BRFksQ0FsQmhCO01Bd0JBLFFBQUEsRUFBVSxTQUFBO0FBQ04sWUFBQTtRQUFBLElBQUEsR0FBTyxXQUFXLENBQUMsWUFBWixDQUF5QixNQUF6QjtRQUlQLElBQUMsQ0FBQSxPQUFELEdBQ0k7VUFBQSxFQUFBLEVBQU8sQ0FBQSxTQUFBO0FBQ0gsZ0JBQUE7WUFBQSxZQUFBLEdBQWUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFDL0Is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QyxDQUFBLE9BQU8sQ0FBQyxFQUF0QjtVQTFHTztRQUFBLENBQUEsQ0FBQSxDQUFBLElBQUEsQ0FBWDtBQTJHQSxlQUFPO01BcE1ELENBeEJWOztFQURhO0FBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4jICBDb2xvciBQaWNrZXIvZXh0ZW5zaW9uczogQWxwaGFcbiMgIENvbG9yIEFscGhhIGNvbnRyb2xsZXJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSAoY29sb3JQaWNrZXIpIC0+XG4gICAgICAgIEVtaXR0ZXI6IChyZXF1aXJlICcuLi9tb2R1bGVzL0VtaXR0ZXInKSgpXG5cbiAgICAgICAgZWxlbWVudDogbnVsbFxuICAgICAgICBjb250cm9sOiBudWxsXG4gICAgICAgIGNhbnZhczogbnVsbFxuXG4gICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgIyAgU2V0IHVwIGV2ZW50cyBhbmQgaGFuZGxpbmdcbiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgIyBTZWxlY3Rpb24gQ2hhbmdlZCBldmVudFxuICAgICAgICBlbWl0U2VsZWN0aW9uQ2hhbmdlZDogLT5cbiAgICAgICAgICAgIEBFbWl0dGVyLmVtaXQgJ3NlbGVjdGlvbkNoYW5nZWQnLCBAY29udHJvbC5zZWxlY3Rpb25cbiAgICAgICAgb25TZWxlY3Rpb25DaGFuZ2VkOiAoY2FsbGJhY2spIC0+XG4gICAgICAgICAgICBARW1pdHRlci5vbiAnc2VsZWN0aW9uQ2hhbmdlZCcsIGNhbGxiYWNrXG5cbiAgICAgICAgIyBDb2xvciBDaGFuZ2VkIGV2ZW50XG4gICAgICAgIGVtaXRDb2xvckNoYW5nZWQ6IC0+XG4gICAgICAgICAgICBARW1pdHRlci5lbWl0ICdjb2xvckNoYW5nZWQnLCBAY29udHJvbC5zZWxlY3Rpb24uY29sb3JcbiAgICAgICAgb25Db2xvckNoYW5nZWQ6IChjYWxsYmFjaykgLT5cbiAgICAgICAgICAgIEBFbWl0dGVyLm9uICdjb2xvckNoYW5nZWQnLCBjYWxsYmFja1xuXG4gICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgIyAgQ3JlYXRlIGFuZCBhY3RpdmF0ZSBBbHBoYSBjb250cm9sbGVyXG4gICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIGFjdGl2YXRlOiAtPlxuICAgICAgICAgICAgQm9keSA9IGNvbG9yUGlja2VyLmdldEV4dGVuc2lvbiAnQm9keSdcblxuICAgICAgICAjICBDcmVhdGUgZWxlbWVudFxuICAgICAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgQGVsZW1lbnQgPVxuICAgICAgICAgICAgICAgIGVsOiBkbyAtPlxuICAgICAgICAgICAgICAgICAgICBfY2xhc3NQcmVmaXggPSBCb2R5LmVsZW1lbnQuZWwuY2xhc3NOYW1lXG4gICAgICAgICAgICAgICAgICAgIF9lbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgJ2RpdidcbiAgICAgICAgICAgICAgICAgICAgX2VsLmNsYXNzTGlzdC5hZGQgXCIjeyBfY2xhc3NQcmVmaXggfS1hbHBoYVwiXG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9lbFxuICAgICAgICAgICAgICAgICMgVXRpbGl0eSBmdW5jdGlvbnNcbiAgICAgICAgICAgICAgICB3aWR0aDogMFxuICAgICAgICAgICAgICAgIGhlaWdodDogMFxuICAgICAgICAgICAgICAgIGdldFdpZHRoOiAtPiByZXR1cm4gQHdpZHRoIG9yIEBlbC5vZmZzZXRXaWR0aFxuICAgICAgICAgICAgICAgIGdldEhlaWdodDogLT4gcmV0dXJuIEBoZWlnaHQgb3IgQGVsLm9mZnNldEhlaWdodFxuXG4gICAgICAgICAgICAgICAgcmVjdDogbnVsbFxuICAgICAgICAgICAgICAgIGdldFJlY3Q6IC0+IHJldHVybiBAcmVjdCBvciBAdXBkYXRlUmVjdCgpXG4gICAgICAgICAgICAgICAgdXBkYXRlUmVjdDogLT4gQHJlY3QgPSBAZWwuZ2V0Q2xpZW50UmVjdHMoKVswXVxuXG4gICAgICAgICAgICAgICAgIyBBZGQgYSBjaGlsZCBvbiB0aGUgQWxwaGEgZWxlbWVudFxuICAgICAgICAgICAgICAgIGFkZDogKGVsZW1lbnQpIC0+XG4gICAgICAgICAgICAgICAgICAgIEBlbC5hcHBlbmRDaGlsZCBlbGVtZW50XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzXG4gICAgICAgICAgICBCb2R5LmVsZW1lbnQuYWRkIEBlbGVtZW50LmVsLCAxXG5cbiAgICAgICAgIyAgVXBkYXRlIGVsZW1lbnQgcmVjdCBwb3NpdGlvbiB3aGVuIENvbG9yIFBpY2tlciBvcGVuc1xuICAgICAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgY29sb3JQaWNrZXIub25PcGVuID0+IEBlbGVtZW50LnVwZGF0ZVJlY3QoKVxuXG4gICAgICAgICMgIENyZWF0ZSBhbmQgZHJhdyBjYW52YXNcbiAgICAgICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIHNldFRpbWVvdXQgPT4gIyB3YWl0IGZvciB0aGUgRE9NXG4gICAgICAgICAgICAgICAgQWxwaGEgPSB0aGlzXG4gICAgICAgICAgICAgICAgU2F0dXJhdGlvbiA9IGNvbG9yUGlja2VyLmdldEV4dGVuc2lvbiAnU2F0dXJhdGlvbidcblxuICAgICAgICAgICAgICAgICMgUHJlcGFyZSBzb21lIHZhcmlhYmxlc1xuICAgICAgICAgICAgICAgIF9lbGVtZW50V2lkdGggPSBAZWxlbWVudC5nZXRXaWR0aCgpXG4gICAgICAgICAgICAgICAgX2VsZW1lbnRIZWlnaHQgPSBAZWxlbWVudC5nZXRIZWlnaHQoKVxuXG4gICAgICAgICAgICAgICAgIyBDcmVhdGUgY2FudmFzIGVsZW1lbnRcbiAgICAgICAgICAgICAgICBAY2FudmFzID1cbiAgICAgICAgICAgICAgICAgICAgZWw6IGRvIC0+XG4gICAgICAgICAgICAgICAgICAgICAgICBfZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50ICdjYW52YXMnXG4gICAgICAgICAgICAgICAgICAgICAgICBfZWwud2lkdGggPSBfZWxlbWVudFdpZHRoXG4gICAgICAgICAgICAgICAgICAgICAgICBfZWwuaGVpZ2h0ID0gX2VsZW1lbnRIZWlnaHRcbiAgICAgICAgICAgICAgICAgICAgICAgIF9lbC5jbGFzc0xpc3QuYWRkIFwiI3sgQWxwaGEuZWxlbWVudC5lbC5jbGFzc05hbWUgfS1jYW52YXNcIlxuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2VsXG4gICAgICAgICAgICAgICAgICAgICMgVXRpbGl0eSBmdW5jdGlvbnNcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dDogbnVsbFxuICAgICAgICAgICAgICAgICAgICBnZXRDb250ZXh0OiAtPiBAY29udGV4dCBvciAoQGNvbnRleHQgPSBAZWwuZ2V0Q29udGV4dCAnMmQnKVxuXG4gICAgICAgICAgICAgICAgICAgICMgUmVuZGVyIEFscGhhIGNhbnZhc1xuICAgICAgICAgICAgICAgICAgICBwcmV2aW91c1JlbmRlcjogbnVsbFxuICAgICAgICAgICAgICAgICAgICByZW5kZXI6IChzbWFydENvbG9yKSAtPlxuICAgICAgICAgICAgICAgICAgICAgICAgX3JnYiA9ICggZG8gLT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmxlc3Mgc21hcnRDb2xvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29sb3JQaWNrZXIuU21hcnRDb2xvci5IRVggJyNmMDAnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gc21hcnRDb2xvclxuICAgICAgICAgICAgICAgICAgICAgICAgKS50b1JHQkFycmF5KCkuam9pbiAnLCdcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlmIEBwcmV2aW91c1JlbmRlciBhbmQgQHByZXZpb3VzUmVuZGVyIGlzIF9yZ2JcblxuICAgICAgICAgICAgICAgICAgICAgICAgIyBHZXQgY29udGV4dCBhbmQgY2xlYXIgaXRcbiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0ID0gQGdldENvbnRleHQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQuY2xlYXJSZWN0IDAsIDAsIF9lbGVtZW50V2lkdGgsIF9lbGVtZW50SGVpZ2h0XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICMgRHJhdyBhbHBoYSBjaGFubmVsXG4gICAgICAgICAgICAgICAgICAgICAgICBfZ3JhZGllbnQgPSBfY29udGV4dC5jcmVhdGVMaW5lYXJHcmFkaWVudCAwLCAwLCAxLCBfZWxlbWVudEhlaWdodFxuICAgICAgICAgICAgICAgICAgICAgICAgX2dyYWRpZW50LmFkZENvbG9yU3RvcCAuMDEsIFwicmdiYSgjeyBfcmdiIH0sMSlcIlxuICAgICAgICAgICAgICAgICAgICAgICAgX2dyYWRpZW50LmFkZENvbG9yU3RvcCAuOTksIFwicmdiYSgjeyBfcmdiIH0sMClcIlxuXG4gICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5maWxsU3R5bGUgPSBfZ3JhZGllbnRcbiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0LmZpbGxSZWN0IDAsIDAsIF9lbGVtZW50V2lkdGgsIF9lbGVtZW50SGVpZ2h0XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gQHByZXZpb3VzUmVuZGVyID0gX3JnYlxuXG4gICAgICAgICAgICAgICAgIyBSZW5kZXIgYWdhaW4gb24gU2F0dXJhdGlvbiBjb2xvciBjaGFuZ2VcbiAgICAgICAgICAgICAgICBTYXR1cmF0aW9uLm9uQ29sb3JDaGFuZ2VkIChzbWFydENvbG9yKSA9PlxuICAgICAgICAgICAgICAgICAgICBAY2FudmFzLnJlbmRlciBzbWFydENvbG9yXG4gICAgICAgICAgICAgICAgQGNhbnZhcy5yZW5kZXIoKVxuXG4gICAgICAgICAgICAgICAgIyBBZGQgdG8gQWxwaGEgZWxlbWVudFxuICAgICAgICAgICAgICAgIEBlbGVtZW50LmFkZCBAY2FudmFzLmVsXG5cbiAgICAgICAgIyAgQ3JlYXRlIEFscGhhIGNvbnRyb2wgZWxlbWVudFxuICAgICAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgc2V0VGltZW91dCA9PiAjIHdhaXQgZm9yIHRoZSBET01cbiAgICAgICAgICAgICAgICBoYXNDaGlsZCA9IChlbGVtZW50LCBjaGlsZCkgLT5cbiAgICAgICAgICAgICAgICAgICAgaWYgY2hpbGQgYW5kIF9wYXJlbnQgPSBjaGlsZC5wYXJlbnROb2RlXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiBjaGlsZCBpcyBlbGVtZW50XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIGhhc0NoaWxkIGVsZW1lbnQsIF9wYXJlbnRcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG5cbiAgICAgICAgICAgICAgICAjIENyZWF0ZSBlbGVtZW50XG4gICAgICAgICAgICAgICAgQWxwaGEgPSB0aGlzXG4gICAgICAgICAgICAgICAgU2F0dXJhdGlvbiA9IGNvbG9yUGlja2VyLmdldEV4dGVuc2lvbiAnU2F0dXJhdGlvbidcblxuICAgICAgICAgICAgICAgIEBjb250cm9sID1cbiAgICAgICAgICAgICAgICAgICAgZWw6IGRvIC0+XG4gICAgICAgICAgICAgICAgICAgICAgICBfZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50ICdkaXYnXG4gICAgICAgICAgICAgICAgICAgICAgICBfZWwuY2xhc3NMaXN0LmFkZCBcIiN7IEFscGhhLmVsZW1lbnQuZWwuY2xhc3NOYW1lIH0tY29udHJvbFwiXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfZWxcbiAgICAgICAgICAgICAgICAgICAgaXNHcmFiYmluZzogbm9cblxuICAgICAgICAgICAgICAgICAgICBwcmV2aW91c0NvbnRyb2xQb3NpdGlvbjogbnVsbFxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVDb250cm9sUG9zaXRpb246ICh5KSAtPlxuICAgICAgICAgICAgICAgICAgICAgICAgX2pvaW5lZCA9IFwiLCN7IHkgfVwiXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWYgQHByZXZpb3VzQ29udHJvbFBvc2l0aW9uIGFuZCBAcHJldmlvdXNDb250cm9sUG9zaXRpb24gaXMgX2pvaW5lZFxuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBAZWwuc3R5bGUudG9wID0gXCIjeyB5IH1weFwiXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gQHByZXZpb3VzQ29udHJvbFBvc2l0aW9uID0gX2pvaW5lZFxuXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGlvbjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHk6IDBcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBudWxsXG4gICAgICAgICAgICAgICAgICAgICAgICBhbHBoYTogbnVsbFxuICAgICAgICAgICAgICAgICAgICBzZXRTZWxlY3Rpb246IChlLCBhbHBoYT1udWxsLCBvZmZzZXQ9bnVsbCkgLT5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9yZWN0ID0gQWxwaGEuZWxlbWVudC5nZXRSZWN0KClcbiAgICAgICAgICAgICAgICAgICAgICAgIF93aWR0aCA9IEFscGhhLmVsZW1lbnQuZ2V0V2lkdGgoKVxuICAgICAgICAgICAgICAgICAgICAgICAgX2hlaWdodCA9IEFscGhhLmVsZW1lbnQuZ2V0SGVpZ2h0KClcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgZSB0aGVuIF95ID0gZS5wYWdlWSAtIF9yZWN0LnRvcFxuICAgICAgICAgICAgICAgICAgICAgICAgIyBTZXQgdGhlIGFscGhhIGRpcmVjdGx5XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgYWxwaGEgaXMgJ251bWJlcicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3kgPSBfaGVpZ2h0IC0gKGFscGhhICogX2hlaWdodCkgIyByZXZlcnNlZCwgMSBpcyB0b3BcbiAgICAgICAgICAgICAgICAgICAgICAgICMgSGFuZGxlIHNjcm9sbFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIG9mZnNldCBpcyAnbnVtYmVyJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfeSA9IEBzZWxlY3Rpb24ueSArIG9mZnNldFxuICAgICAgICAgICAgICAgICAgICAgICAgIyBEZWZhdWx0IHRvIHByZXZpb3VzIHZhbHVlc1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBfeSA9IEBzZWxlY3Rpb24ueVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBfeSA9IEBzZWxlY3Rpb24ueSA9IE1hdGgubWF4IDAsIChNYXRoLm1pbiBfaGVpZ2h0LCBfeSlcblxuICAgICAgICAgICAgICAgICAgICAgICAgX2FscGhhID0gMSAtIChfeSAvIF9oZWlnaHQpICMgcmV2ZXJzZWQsIDEgaXMgdG9wXG4gICAgICAgICAgICAgICAgICAgICAgICBAc2VsZWN0aW9uLmFscGhhID0gKE1hdGgucm91bmQgX2FscGhhICogMTAwKSAvIDEwMCAjIDIgZGVjaW1hbCBwcmVjaXNpb25cblxuICAgICAgICAgICAgICAgICAgICAgICAgIyBVcGRhdGUgdGhlIHNtYXJ0Q29sb3IgKGlmIGFueSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIF9zbWFydENvbG9yID0gQHNlbGVjdGlvbi5jb2xvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9SR0JBQXJyYXkgPSBfc21hcnRDb2xvci50b1JHQkFBcnJheSgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX1JHQkFBcnJheVszXSA9IEBzZWxlY3Rpb24uYWxwaGFcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEBzZWxlY3Rpb24uY29sb3IgPSBjb2xvclBpY2tlci5TbWFydENvbG9yLlJHQkFBcnJheSBfUkdCQUFycmF5XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQWxwaGEuZW1pdENvbG9yQ2hhbmdlZCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAjIE9yIHNldCBhIGRlZmF1bHQgcmVkXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIEBzZWxlY3Rpb24uY29sb3IgPSBjb2xvclBpY2tlci5TbWFydENvbG9yLlJHQkFBcnJheSBbMjU1LCAwLCAwLCBAc2VsZWN0aW9uLmFscGhhXVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBfcG9zaXRpb24gPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk6IE1hdGgubWF4IDMsIChNYXRoLm1pbiAoX2hlaWdodCAtIDYpLCBfeSlcbiAgICAgICAgICAgICAgICAgICAgICAgIEB1cGRhdGVDb250cm9sUG9zaXRpb24gX3Bvc2l0aW9uLnlcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEFscGhhLmVtaXRTZWxlY3Rpb25DaGFuZ2VkKClcblxuICAgICAgICAgICAgICAgICAgICByZWZyZXNoU2VsZWN0aW9uOiAtPiBAc2V0U2VsZWN0aW9uKClcbiAgICAgICAgICAgICAgICBAY29udHJvbC5yZWZyZXNoU2VsZWN0aW9uKClcblxuICAgICAgICAgICAgICAgICMgSWYgdGhlIENvbG9yIFBpY2tlciBpcyBmZWQgYSBjb2xvciwgc2V0IGl0XG4gICAgICAgICAgICAgICAgY29sb3JQaWNrZXIub25JbnB1dENvbG9yIChzbWFydENvbG9yKSA9PlxuICAgICAgICAgICAgICAgICAgICBAY29udHJvbC5zZXRTZWxlY3Rpb24gbnVsbCwgc21hcnRDb2xvci5nZXRBbHBoYSgpXG5cbiAgICAgICAgICAgICAgICAjIFJlc2V0XG4gICAgICAgICAgICAgICAgY29sb3JQaWNrZXIub25PcGVuID0+IEBjb250cm9sLmlzR3JhYmJpbmcgPSBub1xuICAgICAgICAgICAgICAgIGNvbG9yUGlja2VyLm9uQ2xvc2UgPT4gQGNvbnRyb2wuaXNHcmFiYmluZyA9IG5vXG5cbiAgICAgICAgICAgICAgICAjIEJpbmQgY29udHJvbGxlciBldmVudHNcbiAgICAgICAgICAgICAgICBTYXR1cmF0aW9uLm9uQ29sb3JDaGFuZ2VkIChzbWFydENvbG9yKSA9PlxuICAgICAgICAgICAgICAgICAgICBAY29udHJvbC5zZWxlY3Rpb24uY29sb3IgPSBzbWFydENvbG9yXG4gICAgICAgICAgICAgICAgICAgIEBjb250cm9sLnJlZnJlc2hTZWxlY3Rpb24oKVxuXG4gICAgICAgICAgICAgICAgY29sb3JQaWNrZXIub25Nb3VzZURvd24gKGUsIGlzT25QaWNrZXIpID0+XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmxlc3MgaXNPblBpY2tlciBhbmQgaGFzQ2hpbGQgQWxwaGEuZWxlbWVudC5lbCwgZS50YXJnZXRcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgICAgICAgICAgIEBjb250cm9sLmlzR3JhYmJpbmcgPSB5ZXNcbiAgICAgICAgICAgICAgICAgICAgQGNvbnRyb2wuc2V0U2VsZWN0aW9uIGVcblxuICAgICAgICAgICAgICAgIGNvbG9yUGlja2VyLm9uTW91c2VNb3ZlIChlKSA9PlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW5sZXNzIEBjb250cm9sLmlzR3JhYmJpbmdcbiAgICAgICAgICAgICAgICAgICAgQGNvbnRyb2wuc2V0U2VsZWN0aW9uIGVcblxuICAgICAgICAgICAgICAgIGNvbG9yUGlja2VyLm9uTW91c2VVcCAoZSkgPT5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVubGVzcyBAY29udHJvbC5pc0dyYWJiaW5nXG4gICAgICAgICAgICAgICAgICAgIEBjb250cm9sLmlzR3JhYmJpbmcgPSBub1xuICAgICAgICAgICAgICAgICAgICBAY29udHJvbC5zZXRTZWxlY3Rpb24gZVxuXG4gICAgICAgICAgICAgICAgY29sb3JQaWNrZXIub25Nb3VzZVdoZWVsIChlLCBpc09uUGlja2VyKSA9PlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW5sZXNzIGlzT25QaWNrZXIgYW5kIGhhc0NoaWxkIEFscGhhLmVsZW1lbnQuZWwsIGUudGFyZ2V0XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgICAgICAgICAgICAgICBAY29udHJvbC5zZXRTZWxlY3Rpb24gbnVsbCwgbnVsbCwgKGUud2hlZWxEZWx0YVkgKiAuMzMpICMgbWFrZSBpdCBhIGJpdCBzb2Z0ZXJcblxuICAgICAgICAgICAgICAgICMgQWRkIHRvIEFscGhhIGVsZW1lbnRcbiAgICAgICAgICAgICAgICBAZWxlbWVudC5hZGQgQGNvbnRyb2wuZWxcbiAgICAgICAgICAgIHJldHVybiB0aGlzXG4iXX0=
