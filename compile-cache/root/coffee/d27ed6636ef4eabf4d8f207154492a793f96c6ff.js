(function() {
  module.exports = function(colorPicker) {
    return {
      element: null,
      pointer: null,
      activate: function() {
        var _isClicking, hasChild;
        this.element = {
          el: (function() {
            var _classPrefix, _el;
            _classPrefix = colorPicker.element.el.className;
            _el = document.createElement('div');
            _el.classList.add(_classPrefix + "-definition");
            return _el;
          })(),
          height: function() {
            return this.el.offsetHeight;
          },
          add: function(element) {
            this.el.appendChild(element);
            return this;
          },
          setColor: function(smartColor) {
            return this.el.style.backgroundColor = smartColor.toRGBA();
          }
        };
        colorPicker.element.add(this.element.el);
        setTimeout((function(_this) {
          return function() {
            var $colorPicker, Arrow;
            Arrow = colorPicker.getExtension('Arrow');
            $colorPicker = colorPicker.element;
            colorPicker.onInputVariable(function() {
              var _newHeight, _oldHeight, onClose;
              _oldHeight = $colorPicker.height();
              $colorPicker.addClass('view--definition');
              _newHeight = _this.element.height() + Arrow.element.height();
              $colorPicker.setHeight(_newHeight);
              _this.element.setColor(colorPicker.SmartColor.RGBAArray([0, 0, 0, 0]));
              onClose = function() {
                colorPicker.canOpen = true;
                $colorPicker.setHeight(_oldHeight);
                $colorPicker.removeClass('view--definition');
                return colorPicker.Emitter.off('close', onClose);
              };
              return colorPicker.onClose(onClose);
            });
            colorPicker.onInputColor(function() {
              return $colorPicker.removeClass('view--definition');
            });
          };
        })(this));
        colorPicker.onInputVariableColor((function(_this) {
          return function(smartColor) {
            if (!smartColor) {
              return;
            }
            return _this.element.setColor(smartColor);
          };
        })(this));
        colorPicker.onInputVariableColor((function(_this) {
          return function() {
            var pointer;
            pointer = arguments[arguments.length - 1];
            return _this.pointer = pointer;
          };
        })(this));
        hasChild = function(element, child) {
          var _parent;
          if (child && (_parent = child.parentNode)) {
            if (child === element) {
              return true;
            } else {
              return hasChild(element, _parent);
            }
          }
          return false;
        };
        _isClicking = false;
        colorPicker.onMouseDown((function(_this) {
          return function(e, isOnPicker) {
            if (!(isOnPicker && hasChild(_this.element.el, e.target))) {
              return;
            }
            e.preventDefault();
            return _isClicking = true;
          };
        })(this));
        colorPicker.onMouseMove(function(e) {
          return _isClicking = false;
        });
        colorPicker.onMouseUp((function(_this) {
          return function(e) {
            if (!(_isClicking && _this.pointer)) {
              return;
            }
            atom.workspace.open(_this.pointer.filePath).then(function() {
              var Editor;
              Editor = atom.workspace.getActiveTextEditor();
              Editor.clearSelections();
              Editor.setSelectedBufferRange(_this.pointer.range);
              Editor.scrollToCursorPosition();
              return colorPicker.close();
            });
          };
        })(this));
        setTimeout((function(_this) {
          return function() {
            var _definition;
            _definition = document.createElement('p');
            _definition.classList.add(_this.element.el.className + "-definition");
            colorPicker.onInputVariable(function() {
              return _definition.innerText = '';
            });
            colorPicker.onInputVariableColor(function(color) {
              if (color) {
                return _definition.innerText = color.value;
              } else {
                return _definition.innerText = 'No color found.';
              }
            });
            return _this.element.add(_definition);
          };
        })(this));
        setTimeout((function(_this) {
          return function() {
            var _variable;
            _variable = document.createElement('p');
            _variable.classList.add(_this.element.el.className + "-variable");
            colorPicker.onInputVariable(function(match) {
              return _variable.innerText = match.match;
            });
            return _this.element.add(_variable);
          };
        })(this));
        return this;
      }
    };
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiL2hvbWUvc3lhaWYvLmF0b20vcGFja2FnZXMvY29sb3ItcGlja2VyL2xpYi9leHRlbnNpb25zL0RlZmluaXRpb24uY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUtJO0VBQUEsTUFBTSxDQUFDLE9BQVAsR0FBaUIsU0FBQyxXQUFEO1dBQ2I7TUFBQSxPQUFBLEVBQVMsSUFBVDtNQUNBLE9BQUEsRUFBUyxJQURUO01BTUEsUUFBQSxFQUFVLFNBQUE7QUFDTixZQUFBO1FBQUEsSUFBQyxDQUFBLE9BQUQsR0FDSTtVQUFBLEVBQUEsRUFBTyxDQUFBLFNBQUE7QUFDSCxnQkFBQTtZQUFBLFlBQUEsR0FBZSxXQUFXLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztZQUN0QyxHQUFBLEdBQU0sUUFBUSxDQUFDLGFBQVQsQ0FBdUIsS0FBdkI7WUFDTixHQUFHLENBQUMsU0FBUyxDQUFDLEdBQWQsQ0FBc0IsWUFBRixHQUFnQixhQUFwQztBQUVBLG1CQUFPO1VBTEosQ0FBQSxDQUFILENBQUEsQ0FBSjtVQU9BLE1BQUEsRUFBUSxTQUFBO21CQUFHLElBQUMsQ0FBQSxFQUFFLENBQUM7VUFBUCxDQVBSO1VBVUEsR0FBQSxFQUFLLFNBQUMsT0FBRDtZQUNELElBQUMsQ0FBQSxFQUFFLENBQUMsV0FBSixDQUFnQixPQUFoQjtBQUNBLG1CQUFPO1VBRk4sQ0FWTDtVQWVBLFFBQUEsRUFBVSxTQUFDLFVBQUQ7bUJBQ04sSUFBQyxDQUFBLEVBQUUsQ0FBQyxLQUFLLENBQUMsZUFBVixHQUE0QixVQUFVLENBQUMsTUFBWCxDQUFBO1VBRHRCLENBZlY7O1FBaUJKLFdBQVcsQ0FBQyxPQUFPLENBQUMsR0FBcEIsQ0FBd0IsSUFBQyxDQUFBLE9BQU8sQ0FBQyxFQUFqQztRQUlBLFVBQUEsQ0FBVyxDQUFBLFNBQUEsS0FBQTtpQkFBQSxTQUFBO0FBQ1AsZ0JBQUE7WUFBQSxLQUFBLEdBQVEsV0FBVyxDQUFDLFlBQVosQ0FB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QyxlQUFaLENBQTRCLFNBQUMsS0FBRDtxQkFDeEIsU0FBUyxDQUFDLFNBQVYsR0FBc0IsS0FBSyxDQUFDO1lBREosQ0FBNUI7bUJBSUEsS0FBQyxDQUFBLE9BQU8sQ0FBQyxHQUFULENBQWEsU0FBYjtVQVZPO1FBQUEsQ0FBQSxDQUFBLENBQUEsSUFBQSxDQUFYO0FBV0EsZUFBTztNQWxJRCxDQU5WOztFQURhO0FBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4jICBDb2xvciBQaWNrZXIvZXh0ZW5zaW9uczogRGVmaW5pdGlvblxuIyAgVGhlIGVsZW1lbnQgc2hvd2luZyB0aGUgY3VycmVudCB2YXJpYWJsZSBkZWZpbml0aW9uXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gKGNvbG9yUGlja2VyKSAtPlxuICAgICAgICBlbGVtZW50OiBudWxsXG4gICAgICAgIHBvaW50ZXI6IG51bGxcblxuICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICMgIENyZWF0ZSBhbmQgYWN0aXZhdGUgRGVmaW5pdGlvbiBlbGVtZW50XG4gICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIGFjdGl2YXRlOiAtPlxuICAgICAgICAgICAgQGVsZW1lbnQgPVxuICAgICAgICAgICAgICAgIGVsOiBkbyAtPlxuICAgICAgICAgICAgICAgICAgICBfY2xhc3NQcmVmaXggPSBjb2xvclBpY2tlci5lbGVtZW50LmVsLmNsYXNzTmFtZVxuICAgICAgICAgICAgICAgICAgICBfZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50ICdkaXYnXG4gICAgICAgICAgICAgICAgICAgIF9lbC5jbGFzc0xpc3QuYWRkIFwiI3sgX2NsYXNzUHJlZml4IH0tZGVmaW5pdGlvblwiXG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9lbFxuICAgICAgICAgICAgICAgICMgVXRpbGl0eSBmdW5jdGlvbnNcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IC0+IEBlbC5vZmZzZXRIZWlnaHRcblxuICAgICAgICAgICAgICAgICMgQWRkIGEgY2hpbGQgb24gdGhlIERlZmluaXRpb24gZWxlbWVudFxuICAgICAgICAgICAgICAgIGFkZDogKGVsZW1lbnQpIC0+XG4gICAgICAgICAgICAgICAgICAgIEBlbC5hcHBlbmRDaGlsZCBlbGVtZW50XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzXG5cbiAgICAgICAgICAgICAgICAjIFNldCB0aGUgRGVmaW5pdGlvbiBlbGVtZW50IGJhY2tncm91bmQgY29sb3JcbiAgICAgICAgICAgICAgICBzZXRDb2xvcjogKHNtYXJ0Q29sb3IpIC0+XG4gICAgICAgICAgICAgICAgICAgIEBlbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBzbWFydENvbG9yLnRvUkdCQSgpXG4gICAgICAgICAgICBjb2xvclBpY2tlci5lbGVtZW50LmFkZCBAZWxlbWVudC5lbFxuXG4gICAgICAgICMgIFNldCBDb2xvciBQaWNrZXIgaGVpZ2h0XG4gICAgICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICBzZXRUaW1lb3V0ID0+XG4gICAgICAgICAgICAgICAgQXJyb3cgPSBjb2xvclBpY2tlci5nZXRFeHRlbnNpb24gJ0Fycm93J1xuICAgICAgICAgICAgICAgICRjb2xvclBpY2tlciA9IGNvbG9yUGlja2VyLmVsZW1lbnRcblxuICAgICAgICAgICAgICAgICMgQ2hhbmdlIHZpZXcgbW9kZSB3aGVuIGEgdmFyaWFibGUgaXMgaW5wdXRcbiAgICAgICAgICAgICAgICBjb2xvclBpY2tlci5vbklucHV0VmFyaWFibGUgPT5cbiAgICAgICAgICAgICAgICAgICAgX29sZEhlaWdodCA9ICRjb2xvclBpY2tlci5oZWlnaHQoKVxuICAgICAgICAgICAgICAgICAgICAkY29sb3JQaWNrZXIuYWRkQ2xhc3MgJ3ZpZXctLWRlZmluaXRpb24nXG5cbiAgICAgICAgICAgICAgICAgICAgX25ld0hlaWdodCA9IEBlbGVtZW50LmhlaWdodCgpICsgQXJyb3cuZWxlbWVudC5oZWlnaHQoKVxuICAgICAgICAgICAgICAgICAgICAkY29sb3JQaWNrZXIuc2V0SGVpZ2h0IF9uZXdIZWlnaHRcblxuICAgICAgICAgICAgICAgICAgICAjIFJlc2V0IGN1cnJlbnQgZWxlbWVudCBiYWNrZ3JvdW5kIGNvbG9yXG4gICAgICAgICAgICAgICAgICAgIEBlbGVtZW50LnNldENvbG9yIGNvbG9yUGlja2VyLlNtYXJ0Q29sb3IuUkdCQUFycmF5IFswLCAwLCAwLCAwXVxuXG4gICAgICAgICAgICAgICAgICAgICMgUmVzZXQgcGlja2VyIG9uIGNsb3NlLCBhbmQgY2xlYXIgdGhlIGV2ZW50XG4gICAgICAgICAgICAgICAgICAgICMgVE9ETyBoYW5kbGUgdGhpcyBvbiB0aGUgQ29sb3JQaWNrZXIgaXRzZWxmLCBtYXliZT9cbiAgICAgICAgICAgICAgICAgICAgb25DbG9zZSA9IC0+XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvclBpY2tlci5jYW5PcGVuID0geWVzXG4gICAgICAgICAgICAgICAgICAgICAgICAkY29sb3JQaWNrZXIuc2V0SGVpZ2h0IF9vbGRIZWlnaHRcbiAgICAgICAgICAgICAgICAgICAgICAgICRjb2xvclBpY2tlci5yZW1vdmVDbGFzcyAndmlldy0tZGVmaW5pdGlvbidcblxuICAgICAgICAgICAgICAgICAgICAgICAgIyBUT0RPOiBUaGlzIGtpbmRhIGdvZXMgYWdhaW5zdCB0aGUgJ25vIHN0cmluZ3MnIHRoaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvclBpY2tlci5FbWl0dGVyLm9mZiAnY2xvc2UnLCBvbkNsb3NlXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yUGlja2VyLm9uQ2xvc2Ugb25DbG9zZVxuXG4gICAgICAgICAgICAgICAgIyBNYWtlIHN1cmUgdGhlIGNsYXNzIGlzIG5ldmVyIHNldCB3aGVuIGEgY29sb3IgaXMgaW5wdXRcbiAgICAgICAgICAgICAgICBjb2xvclBpY2tlci5vbklucHV0Q29sb3IgLT5cbiAgICAgICAgICAgICAgICAgICAgJGNvbG9yUGlja2VyLnJlbW92ZUNsYXNzICd2aWV3LS1kZWZpbml0aW9uJ1xuICAgICAgICAgICAgICAgIHJldHVyblxuXG4gICAgICAgICMgIFNldCBiYWNrZ3JvdW5kIGVsZW1lbnQgY29sb3Igb24gY2hhbmdlXG4gICAgICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICBjb2xvclBpY2tlci5vbklucHV0VmFyaWFibGVDb2xvciAoc21hcnRDb2xvcikgPT5cbiAgICAgICAgICAgICAgICByZXR1cm4gdW5sZXNzIHNtYXJ0Q29sb3JcbiAgICAgICAgICAgICAgICBAZWxlbWVudC5zZXRDb2xvciBzbWFydENvbG9yXG5cbiAgICAgICAgIyAgU2V0IG9yIHJlcGxhY2Ugc2VsZWN0aW9uIG9uIGNsaWNrXG4gICAgICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICBjb2xvclBpY2tlci5vbklucHV0VmFyaWFibGVDb2xvciAoLi4uLCBwb2ludGVyKSA9PlxuICAgICAgICAgICAgICAgICMgS2VlcCB0cmFjayBvZiB0aGUgY3VycmVudCBwb2ludGVyIGZvciB3aGVuIHRoZSBjb2xvciBpc1xuICAgICAgICAgICAgICAgICMgc3VwcG9zZWQgdG8gYmUgcmVwbGFjZWRcbiAgICAgICAgICAgICAgICBAcG9pbnRlciA9IHBvaW50ZXJcblxuICAgICAgICAgICAgaGFzQ2hpbGQgPSAoZWxlbWVudCwgY2hpbGQpIC0+XG4gICAgICAgICAgICAgICAgaWYgY2hpbGQgYW5kIF9wYXJlbnQgPSBjaGlsZC5wYXJlbnROb2RlXG4gICAgICAgICAgICAgICAgICAgIGlmIGNoaWxkIGlzIGVsZW1lbnRcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIGhhc0NoaWxkIGVsZW1lbnQsIF9wYXJlbnRcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcblxuICAgICAgICAgICAgX2lzQ2xpY2tpbmcgPSBub1xuXG4gICAgICAgICAgICBjb2xvclBpY2tlci5vbk1vdXNlRG93biAoZSwgaXNPblBpY2tlcikgPT5cbiAgICAgICAgICAgICAgICByZXR1cm4gdW5sZXNzIGlzT25QaWNrZXIgYW5kIGhhc0NoaWxkIEBlbGVtZW50LmVsLCBlLnRhcmdldFxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgICAgICAgICAgIF9pc0NsaWNraW5nID0geWVzXG5cbiAgICAgICAgICAgIGNvbG9yUGlja2VyLm9uTW91c2VNb3ZlIChlKSAtPlxuICAgICAgICAgICAgICAgIF9pc0NsaWNraW5nID0gbm9cblxuICAgICAgICAgICAgY29sb3JQaWNrZXIub25Nb3VzZVVwIChlKSA9PlxuICAgICAgICAgICAgICAgIHJldHVybiB1bmxlc3MgX2lzQ2xpY2tpbmcgYW5kIEBwb2ludGVyXG5cbiAgICAgICAgICAgICAgICBhdG9tLndvcmtzcGFjZS5vcGVuKEBwb2ludGVyLmZpbGVQYXRoKS50aGVuID0+XG4gICAgICAgICAgICAgICAgICAgIEVkaXRvciA9IGF0b20ud29ya3NwYWNlLmdldEFjdGl2ZVRleHRFZGl0b3IoKVxuICAgICAgICAgICAgICAgICAgICBFZGl0b3IuY2xlYXJTZWxlY3Rpb25zKClcbiAgICAgICAgICAgICAgICAgICAgRWRpdG9yLnNldFNlbGVjdGVkQnVmZmVyUmFuZ2UgQHBvaW50ZXIucmFuZ2VcbiAgICAgICAgICAgICAgICAgICAgRWRpdG9yLnNjcm9sbFRvQ3Vyc29yUG9zaXRpb24oKVxuXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yUGlja2VyLmNsb3NlKClcbiAgICAgICAgICAgICAgICByZXR1cm5cblxuICAgICAgICAjICBDcmVhdGUgRGVmaW5pdGlvbiBkZWZpbml0aW9uIHRleHQgZWxlbWVudFxuICAgICAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgc2V0VGltZW91dCA9PlxuICAgICAgICAgICAgICAgICMgQ3JlYXRlIGRlZmluaXRpb24gdGV4dCBlbGVtZW50XG4gICAgICAgICAgICAgICAgX2RlZmluaXRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50ICdwJ1xuICAgICAgICAgICAgICAgIF9kZWZpbml0aW9uLmNsYXNzTGlzdC5hZGQgXCIjeyBAZWxlbWVudC5lbC5jbGFzc05hbWUgfS1kZWZpbml0aW9uXCJcblxuICAgICAgICAgICAgICAgICMgUmVtb3ZlIHRoZSBkZWZpbml0aW9uIHdoZW4gYSBuZXcgdmFyaWFibGUgaXMgaW5wdXRcbiAgICAgICAgICAgICAgICBjb2xvclBpY2tlci5vbklucHV0VmFyaWFibGUgLT5cbiAgICAgICAgICAgICAgICAgICAgX2RlZmluaXRpb24uaW5uZXJUZXh0ID0gJydcblxuICAgICAgICAgICAgICAgICMgU2V0IGRlZmluaXRpb24gd2hlbiB0aGUgZGVmaW5pdGlvbiBpcyBmb3VuZFxuICAgICAgICAgICAgICAgIGNvbG9yUGlja2VyLm9uSW5wdXRWYXJpYWJsZUNvbG9yIChjb2xvcikgLT5cbiAgICAgICAgICAgICAgICAgICAgIyBJZiBhIGNvbG9yIGRlZmluaXRpb24gaXMgZm91bmRcbiAgICAgICAgICAgICAgICAgICAgaWYgY29sb3IgdGhlbiBfZGVmaW5pdGlvbi5pbm5lclRleHQgPSBjb2xvci52YWx1ZVxuICAgICAgICAgICAgICAgICAgICAjIElmIG5vIGRlZmluaXRpb24gaXMgZm91bmQsIHNob3cgYW4gZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBfZGVmaW5pdGlvbi5pbm5lclRleHQgPSAnTm8gY29sb3IgZm91bmQuJ1xuXG4gICAgICAgICAgICAgICAgIyBBZGQgdG8gRGVmaW5pdGlvbiBlbGVtZW50XG4gICAgICAgICAgICAgICAgQGVsZW1lbnQuYWRkIF9kZWZpbml0aW9uXG5cbiAgICAgICAgIyAgQ3JlYXRlIERlZmluaXRpb24gdmFyaWFibGUgdGV4dCBlbGVtZW50XG4gICAgICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICBzZXRUaW1lb3V0ID0+XG4gICAgICAgICAgICAgICAgIyBDcmVhdGUgdmFyaWFibGUgdGV4dCBlbGVtZW50XG4gICAgICAgICAgICAgICAgX3ZhcmlhYmxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCAncCdcbiAgICAgICAgICAgICAgICBfdmFyaWFibGUuY2xhc3NMaXN0LmFkZCBcIiN7IEBlbGVtZW50LmVsLmNsYXNzTmFtZSB9LXZhcmlhYmxlXCJcblxuICAgICAgICAgICAgICAgICMgU2V0IHZhcmlhYmxlIHdoZW4gdGhlIHZhcmlhYmxlIGlzIGlucHV0XG4gICAgICAgICAgICAgICAgY29sb3JQaWNrZXIub25JbnB1dFZhcmlhYmxlIChtYXRjaCkgLT5cbiAgICAgICAgICAgICAgICAgICAgX3ZhcmlhYmxlLmlubmVyVGV4dCA9IG1hdGNoLm1hdGNoXG5cbiAgICAgICAgICAgICAgICAjIEFkZCB0byBEZWZpbml0aW9uIGVsZW1lbnRcbiAgICAgICAgICAgICAgICBAZWxlbWVudC5hZGQgX3ZhcmlhYmxlXG4gICAgICAgICAgICByZXR1cm4gdGhpc1xuIl19
